<!DOCTYPE html>
<!-- saved from url=(0049)https://mp4_damage.pyscriptapps.com/index/latest/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>è§†é¢‘è‰ºæœ¯æŸåå·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        .output-area {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 20px 0;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }
        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 16px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        .status {
            padding: 12px;
            margin: 10px 0;
            border-radius: 5px;
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            font-weight: bold;
        }
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .checkbox-item:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }
        .checkbox-item.selected {
            border-color: #27ae60;
            background: #d4edda;
            font-weight: bold;
        }
        .checkbox-item input {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
            min-width: 150px;
            font-size: 14px;
            transition: background 0.3s ease;
        }
        button:hover {
            background: #2980b9;
        }
        .process-btn {
            background: #27ae60;
            font-weight: bold;
            font-size: 16px;
        }
        .process-btn:hover {
            background: #219653;
        }
        .tutorial-btn {
            background: #f39c12;
        }
        .tutorial-btn:hover {
            background: #e67e22;
        }
        .file-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        /* è‡ªå®šä¹‰è¾“å…¥å¯¹è¯æ¡†æ ·å¼ */
        .custom-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            min-width: 350px;
            max-width: 500px;
        }
        .custom-dialog h3 {
            margin-top: 0;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .custom-dialog p {
            margin-bottom: 15px;
            color: #555;
        }
        .custom-dialog input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid #3498db;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .custom-dialog-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .custom-dialog-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 0;
            min-width: auto;
        }
        .custom-dialog-confirm {
            background: #27ae60;
            color: white;
        }
        .custom-dialog-confirm:hover {
            background: #219653;
        }
        .custom-dialog-cancel {
            background: #95a5a6;
            color: white;
        }
        .custom-dialog-cancel:hover {
            background: #7f8c8d;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        .current-settings {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }
        .current-settings h4 {
            margin-top: 0;
            color: #2c3e50;
        }
        .setting-item {
            margin: 5px 0;
            padding: 3px 0;
        }
        .setting-value {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .warning {
            color: #f39c12;
            font-weight: bold;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #27ae60;
            border-radius: 10px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* å…è´£å£°æ˜å¯¹è¯æ¡†æ ·å¼ */
        .disclaimer-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1001;
            min-width: 400px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .disclaimer-dialog h3 {
            margin-top: 0;
            color: #e74c3c;
            margin-bottom: 20px;
            text-align: center;
        }
        .disclaimer-content {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-size: 14px;
            line-height: 1.6;
        }
        .disclaimer-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .disclaimer-content li {
            margin: 8px 0;
        }
        .warning-icon {
            color: #e74c3c;
            font-weight: bold;
            margin-right: 5px;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .checkbox-container input {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .checkbox-container label {
            font-weight: bold;
            color: #2c3e50;
        }
    </style>

    <link rel="manifest" href="https://mp4_damage.pyscriptapps.com/index/latest/psadc-manifest.json">
<script type="text/javascript" async="" src="./è§†é¢‘è‰ºæœ¯æŸåå·¥_files/07f601a1d4aaf.js.ä¸‹è½½"></script></head>
<body>
    <div class="container">
        <h1>ğŸ¬ è§†é¢‘è‰ºæœ¯æŸåå·¥å…·</h1>
        
        <div class="status" id="status">ç­‰å¾…ç”¨æˆ·ç¡®è®¤å…è´£å£°æ˜</div>

        <!-- å½“å‰è®¾ç½®æ˜¾ç¤º -->
        <div class="current-settings">
            <h4>ğŸ“‹ å½“å‰è®¾ç½®</h4>
            <div class="setting-item">æ–‡ä»¶é€‰æ‹©: <span id="currentFile" class="setting-value">æœªé€‰æ‹©æ–‡ä»¶</span></div>
            <div class="setting-item">å·¥ä½œæ¨¡å¼: <span id="currentMode" class="setting-value">MP4æ¨¡å¼</span></div>
            <div class="setting-item">æŸåç±»å‹: <span id="currentType" class="setting-value">æœªé€‰æ‹©</span></div>
            <div class="setting-item">æŸåå¼ºåº¦: <span id="currentIntensity" class="setting-value">æœªé€‰æ‹©</span></div>
            <div class="setting-item">è¾“å‡ºæ–‡ä»¶å: <span id="currentOutput" class="setting-value">glitched_video.mp4</span></div>
        </div>

        <!-- æ–‡ä»¶é€‰æ‹©éƒ¨åˆ† -->
        <div class="section">
            <div class="section-title">ğŸ“ æ–‡ä»¶é€‰æ‹©</div>
            <div class="button-group">
                <button onclick="selectFile()">é€‰æ‹©è§†é¢‘æ–‡ä»¶</button>
                <button onclick="showOutputFileDialog()">è®¾ç½®è¾“å‡ºæ–‡ä»¶å</button>
            </div>
            <div class="file-info" id="fileInfo">
                æœªé€‰æ‹©æ–‡ä»¶
            </div>
        </div>

        <!-- å·¥ä½œæ¨¡å¼é€‰æ‹© -->
        <div class="section">
            <div class="section-title">âš™ï¸ å·¥ä½œæ¨¡å¼</div>
            <div class="checkbox-group" id="modeSelection">
                <div class="checkbox-item selected" onclick="selectMode(&#39;mp4&#39;)">
                    <input type="radio" name="mode" value="mp4" checked=""> 
                    MP4æ¨¡å¼ (ä¿æŠ¤å…³é”®æ•°æ®)
                </div>
                <div class="checkbox-item" onclick="selectMode(&#39;file&#39;)">
                    <input type="radio" name="mode" value="file"> 
                    æ–‡ä»¶æ¨¡å¼ (æ— ä¿æŠ¤ï¼Œå…¨æ–‡ä»¶æŸå)
                </div>
            </div>
        </div>

        <!-- æŸåç±»å‹é€‰æ‹© -->
        <div class="section">
            <div class="section-title">ğŸ¯ æŸåç±»å‹</div>
            <div class="checkbox-group" id="typeSelection">
                <div class="checkbox-item" onclick="selectType(&#39;1&#39;)">
                    <input type="radio" name="type" value="1"> mode1
                </div>
                <div class="checkbox-item" onclick="selectType(&#39;2&#39;)">
                    <input type="radio" name="type" value="2"> mode2
                </div>
                <div class="checkbox-item" onclick="selectType(&#39;3&#39;)">
                    <input type="radio" name="type" value="3"> mode3
                </div>
                <div class="checkbox-item" onclick="selectType(&#39;4&#39;)">
                    <input type="radio" name="type" value="4"> mode4
                </div>
                <div class="checkbox-item" onclick="selectType(&#39;5&#39;)">
                    <input type="radio" name="type" value="5"> mode5
                </div>
                <div class="checkbox-item" onclick="selectType(&#39;6&#39;)">
                    <input type="radio" name="type" value="6"> mode6
                </div>
                <div class="checkbox-item" onclick="selectType(&#39;7&#39;)">
                    <input type="radio" name="type" value="7"> mode7
                </div>
                <div class="checkbox-item" onclick="selectType(&#39;8&#39;)">
                    <input type="radio" name="type" value="8"> å®Œå…¨å´©æºƒ
                </div>
            </div>
        </div>

        <!-- æŸåå¼ºåº¦é€‰æ‹© -->
        <div class="section">
            <div class="section-title">âš¡ æŸåå¼ºåº¦</div>
            <div class="checkbox-group" id="intensitySelection">
                <div class="checkbox-item" onclick="selectIntensity(&#39;1&#39;)">
                    <input type="radio" name="intensity" value="1"> 0.00001 - æè½»å¾® (0.0001%)
                </div>
                <div class="checkbox-item" onclick="selectIntensity(&#39;2&#39;)">
                    <input type="radio" name="intensity" value="2"> 0.0001 - è½»å¾® (0.001%)
                </div>
                <div class="checkbox-item" onclick="selectIntensity(&#39;3&#39;)">
                    <input type="radio" name="intensity" value="3"> 0.001 - ä¸­ç­‰ (0.01%)
                </div>
                <div class="checkbox-item" onclick="selectIntensity(&#39;4&#39;)">
                    <input type="radio" name="intensity" value="4"> 0.01 - å¼ºçƒˆ (0.1%)
                </div>
                <div class="checkbox-item" onclick="selectIntensity(&#39;5&#39;)">
                    <input type="radio" name="intensity" value="5"> 0.08 - æ¯ç­çº§ (0.8%)
                </div>
                <div class="checkbox-item" onclick="showCustomIntensityDialog()">
                    <input type="radio" name="intensity" value="6"> custom - è‡ªå®šä¹‰å¼ºåº¦
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="section">
            <div class="section-title">ğŸš€ å¤„ç†æ“ä½œ</div>
            <div class="button-group">
                <button onclick="startProcessing()" class="process-btn">å¼€å§‹æŸåå¤„ç†</button>
                <button onclick="showTutorial()" class="tutorial-btn">ä½¿ç”¨æ•™ç¨‹</button>
                <button onclick="resetSettings()">é‡ç½®è®¾ç½®</button>
            </div>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="section" id="progressSection" style="display: none;">
            <div class="section-title">ğŸ“Š å¤„ç†è¿›åº¦</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="progressText" style="text-align: center; margin-top: 5px;">0%</div>
        </div>

        <!-- è¾“å‡ºåŒºåŸŸ -->
        <div class="output-area" id="output">âŒ æ–‡ä»¶é€‰æ‹©å·²å–æ¶ˆï¼Œè¯·ç¡®è®¤å…è´£å£°æ˜åç»§ç»­</div>

        <input type="file" id="fileInput" accept=".mp4" style="display: none;">
        
        <!-- ä¸‹è½½é“¾æ¥ï¼ˆéšè—ï¼‰ -->
        <a id="downloadLink" style="display: none;"></a>
    </div>

    <!-- å…è´£å£°æ˜å¯¹è¯æ¡† -->
    <div id="disclaimerDialog" class="disclaimer-dialog" style="display: none;">
        <h3>âš ï¸ é‡è¦å£°æ˜</h3>
        <div class="disclaimer-content">
            <p><span class="warning-icon">âš </span> <strong>æœ¬å·¥å…·ä»…ä¾›å¨±ä¹å’Œå­¦ä¹ ç›®çš„ä½¿ç”¨</strong></p>
            
            <p><strong>é‡è¦æé†’ï¼š</strong></p>
            <ul>
                <li>è¯·ä½¿ç”¨<strong>æ²¡æœ‰éŸ³é¢‘</strong>çš„è§†é¢‘æ–‡ä»¶è¿›è¡Œå¤„ç†</li>
                <li>åŒ…å«éŸ³é¢‘çš„è§†é¢‘æ–‡ä»¶å¤„ç†æ—¶å®¹æ˜“å‡ºç°æ•…éšœ</li>
                <li>å¤„ç†å‰è¯·å¤‡ä»½åŸå§‹æ–‡ä»¶</li>
                <li>æŸååçš„æ–‡ä»¶å¯èƒ½æ— æ³•æ’­æ”¾æˆ–å‡ºç°å¼‚å¸¸</li>
                <li>æœ¬å·¥å…·ä¸ä¿è¯å¤„ç†åçš„æ–‡ä»¶è´¨é‡</li>
                <li>è§†é¢‘æ–‡ä»¶è¯·ä½¿ç”¨MP4æ ¼å¼</li>
            </ul>
            
            <p><strong>å»ºè®®ï¼š</strong></p>
            <ul>
                <li>ä½¿ç”¨çŸ­å°çš„æµ‹è¯•è§†é¢‘è¿›è¡Œå°è¯•</li>
                <li>ä»è¾ƒä½çš„æŸåå¼ºåº¦å¼€å§‹</li>
                <li>é¿å…å¤„ç†é‡è¦æˆ–çè´µçš„è§†é¢‘æ–‡ä»¶</li>
            </ul>
        </div>
        
        <div class="checkbox-container">
            <input type="checkbox" id="understandCheckbox">
            <label for="understandCheckbox">æˆ‘å·²é˜…è¯»å¹¶ç†è§£ä¸Šè¿°å£°æ˜ï¼Œç¡®è®¤ä½¿ç”¨æ— éŸ³é¢‘çš„è§†é¢‘æ–‡ä»¶</label>
        </div>
        
        <div class="custom-dialog-buttons">
            <button class="custom-dialog-cancel" onclick="cancelDisclaimer()">å–æ¶ˆ</button>
            <button class="custom-dialog-confirm" onclick="confirmDisclaimer()" id="confirmDisclaimerBtn" disabled="">ç¡®è®¤å¹¶é€‰æ‹©æ–‡ä»¶</button>
        </div>
    </div>
    <div id="disclaimerOverlay" class="overlay" style="display: none;"></div>

    <!-- è‡ªå®šä¹‰å¼ºåº¦è¾“å…¥å¯¹è¯æ¡† -->
    <div id="customIntensityDialog" class="custom-dialog" style="display: none;">
        <h3>è‡ªå®šä¹‰å¼ºåº¦è®¾ç½®</h3>
        <p>è¯·è¾“å…¥å¼ºåº¦å€¼ (0.00001-100):</p>
        <input type="number" id="customIntensityInput" step="0.00001" min="0.00001" max="100" value="0.0005" placeholder="ä¾‹å¦‚: 0.0005">
        <div class="custom-dialog-buttons">
            <button class="custom-dialog-confirm" onclick="confirmCustomIntensity()">ç¡®è®¤</button>
            <button class="custom-dialog-cancel" onclick="cancelCustomIntensity()">å–æ¶ˆ</button>
        </div>
    </div>
    <div id="customIntensityOverlay" class="overlay" style="display: none;"></div>

    <!-- è¾“å‡ºæ–‡ä»¶åè®¾ç½®å¯¹è¯æ¡† -->
    <div id="outputFileDialog" class="custom-dialog" style="display: none;">
        <h3>è®¾ç½®è¾“å‡ºæ–‡ä»¶å</h3>
        <p>è¯·è¾“å…¥è¾“å‡ºæ–‡ä»¶åï¼ˆå°†ä¿å­˜åˆ°æµè§ˆå™¨ä¸‹è½½ï¼‰:</p>
        <input type="text" id="outputFileInput" placeholder="ä¾‹å¦‚: glitched_video.mp4" value="glitched_video.mp4">
        <div class="custom-dialog-buttons">
            <button class="custom-dialog-confirm" onclick="confirmOutputFile()">ç¡®è®¤</button>
            <button class="custom-dialog-cancel" onclick="cancelOutputFile()">å–æ¶ˆ</button>
        </div>
    </div>
    <div id="outputFileOverlay" class="overlay" style="display: none;"></div>

    <script type="text/javascript" async="" src="./è§†é¢‘è‰ºæœ¯æŸåå·¥_files/heap-758475466.js.ä¸‹è½½"></script><script>
        // åº”ç”¨ç¨‹åºçŠ¶æ€
        const app = {
            inputFile: null,
            mode: 'mp4',
            glitchType: 'æœªé€‰æ‹©',
            intensity: 'æœªé€‰æ‹©',
            outputFile: 'glitched_video.mp4',
            fileContent: null,
            fileType: null,
            disclaimerAccepted: false
        };

        // æ˜¾ç¤ºæ¶ˆæ¯åˆ°è¾“å‡ºåŒºåŸŸ
        function displayMessage(message) {
            const output = document.getElementById('output');
            if (output) {
                output.textContent = message;
            }
        }

        // æ›´æ–°çŠ¶æ€æ 
        function updateStatus(message) {
            const status = document.getElementById('status');
            if (status) {
                status.textContent = message;
            }
        }

        // æ›´æ–°å½“å‰è®¾ç½®æ˜¾ç¤º
        function updateCurrentSettingsDisplay() {
            document.getElementById('currentFile').textContent = app.inputFile || 'æœªé€‰æ‹©æ–‡ä»¶';
            document.getElementById('currentMode').textContent = app.mode === 'mp4' ? 'MP4æ¨¡å¼' : 'æ–‡ä»¶æ¨¡å¼';
            document.getElementById('currentType').textContent = app.glitchType;
            document.getElementById('currentIntensity').textContent = app.intensity;
            document.getElementById('currentOutput').textContent = app.outputFile;
        }

        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        function showError(message) {
            displayMessage('âŒ ' + message);
        }

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function showSuccess(message) {
            displayMessage('âœ… ' + message);
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percent) {
            const progressSection = document.getElementById('progressSection');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            if (progressSection) progressSection.style.display = 'block';
            if (progressFill) progressFill.style.width = percent + '%';
            if (progressText) progressText.textContent = percent + '%';
        }

        // éšè—è¿›åº¦æ¡
        function hideProgress() {
            const progressSection = document.getElementById('progressSection');
            if (progressSection) progressSection.style.display = 'none';
        }

        // æ–‡ä»¶é€‰æ‹©å‡½æ•° - æ˜¾ç¤ºå…è´£å£°æ˜
        function selectFile() {
            if (!app.disclaimerAccepted) {
                showDisclaimerDialog();
            } else {
                document.getElementById('fileInput').click();
            }
        }

        // æ˜¾ç¤ºå…è´£å£°æ˜å¯¹è¯æ¡†
        function showDisclaimerDialog() {
            const dialog = document.getElementById('disclaimerDialog');
            const overlay = document.getElementById('disclaimerOverlay');
            if (dialog && overlay) {
                dialog.style.display = 'block';
                overlay.style.display = 'block';
                
                // é‡ç½®å¤é€‰æ¡†çŠ¶æ€
                const checkbox = document.getElementById('understandCheckbox');
                if (checkbox) {
                    checkbox.checked = false;
                }
                
                // ç¦ç”¨ç¡®è®¤æŒ‰é’®
                const confirmBtn = document.getElementById('confirmDisclaimerBtn');
                if (confirmBtn) {
                    confirmBtn.disabled = true;
                }
            }
        }

        // ç¡®è®¤å…è´£å£°æ˜
        function confirmDisclaimer() {
            const checkbox = document.getElementById('understandCheckbox');
            if (checkbox && checkbox.checked) {
                app.disclaimerAccepted = true;
                hideDisclaimerDialog();
                // ç°åœ¨è§¦å‘æ–‡ä»¶é€‰æ‹©
                document.getElementById('fileInput').click();
            }
        }

        // å–æ¶ˆå…è´£å£°æ˜
        function cancelDisclaimer() {
            hideDisclaimerDialog();
            displayMessage('âŒ æ–‡ä»¶é€‰æ‹©å·²å–æ¶ˆï¼Œè¯·ç¡®è®¤å…è´£å£°æ˜åç»§ç»­');
            updateStatus('ç­‰å¾…ç”¨æˆ·ç¡®è®¤å…è´£å£°æ˜');
        }

        // éšè—å…è´£å£°æ˜å¯¹è¯æ¡†
        function hideDisclaimerDialog() {
            const dialog = document.getElementById('disclaimerDialog');
            const overlay = document.getElementById('disclaimerOverlay');
            if (dialog && overlay) {
                dialog.style.display = 'none';
                overlay.style.display = 'none';
            }
        }

        // ç›‘å¬å…è´£å£°æ˜å¤é€‰æ¡†å˜åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const checkbox = document.getElementById('understandCheckbox');
            const confirmBtn = document.getElementById('confirmDisclaimerBtn');
            
            if (checkbox && confirmBtn) {
                checkbox.addEventListener('change', function() {
                    confirmBtn.disabled = !this.checked;
                });
            }
        });

        function selectMode(mode) {
            // æ›´æ–°å•é€‰æŒ‰é’®çŠ¶æ€
            const items = document.querySelectorAll('#modeSelection .checkbox-item');
            items.forEach(item => {
                const input = item.querySelector('input');
                if (input.value === mode) {
                    item.classList.add('selected');
                    input.checked = true;
                } else {
                    item.classList.remove('selected');
                    input.checked = false;
                }
            });
            
            // æ›´æ–°åº”ç”¨ç¨‹åºçŠ¶æ€
            app.mode = mode;
            if (mode === 'file') {
                app.glitchType = 'å®Œå…¨å´©æºƒ';
                updateCurrentSettingsDisplay();
                displayMessage('âœ… å·²é€‰æ‹©å·¥ä½œæ¨¡å¼: æ–‡ä»¶æ¨¡å¼\n\næ–‡ä»¶æ¨¡å¼å·²å¼ºåˆ¶ä½¿ç”¨"å®Œå…¨å´©æºƒ"ç±»å‹');
            }
            updateCurrentSettingsDisplay();
            updateStatus(app.mode === 'mp4' ? 'âœ… MP4æ¨¡å¼' : 'âœ… æ–‡ä»¶æ¨¡å¼');
        }

        function selectType(type) {
            if (app.mode === 'file') {
                displayMessage('â„¹ï¸ æ–‡ä»¶æ¨¡å¼å·²å¼ºåˆ¶ä½¿ç”¨"å®Œå…¨å´©æºƒ"ç±»å‹');
                return;
            }
            
            // æ›´æ–°å•é€‰æŒ‰é’®çŠ¶æ€
            const items = document.querySelectorAll('#typeSelection .checkbox-item');
            items.forEach(item => {
                const input = item.querySelector('input');
                if (input.value === type) {
                    item.classList.add('selected');
                    input.checked = true;
                } else {
                    item.classList.remove('selected');
                    input.checked = false;
                }
            });
            
            // æ›´æ–°åº”ç”¨ç¨‹åºçŠ¶æ€
            const types = {
                '1': 'mode1', '2': 'mode2', '3': 'mode3', 
                '4': 'mode4', '5': 'mode5', '6': 'mode6', 
                '7': 'mode7', '8': 'å®Œå…¨å´©æºƒ'
            };
            app.glitchType = types[type] || 'æœªé€‰æ‹©';
            updateCurrentSettingsDisplay();
            updateStatus('âœ… æŸåç±»å‹: ' + app.glitchType);
            
            const typeDescriptions = {
                'mode1': 'çº¿æ¡æŸåæ•ˆæœ - æ¨¡æ‹Ÿæ‰«æçº¿æ•…éšœ',
                'mode2': 'æ—¶é—´å€’æµæ•ˆæœ - åˆ›å»ºæ—¶é—´åè½¬æ•ˆæœ', 
                'mode3': 'è‰²å—å¼‚å¸¸æ•ˆæœ - äº§ç”Ÿè‰²å—å¤±çœŸ',
                'mode4': 'æ•°æ®æ··åˆæ•ˆæœ - æ··åˆæ•°æ®åˆ›å»ºæ··ä¹±',
                'mode5': 'ç”»é¢å†»ç»“æ•ˆæœ - æ¨¡æ‹Ÿç”»é¢å†»ç»“',
                'mode6': 'ç”»é¢æŠ–åŠ¨æ•ˆæœ - åˆ›å»ºæŠ–åŠ¨æ•ˆæœ',
                'mode7': 'é€šé“åç§»æ•ˆæœ - RGBé€šé“åç§»',
                'å®Œå…¨å´©æºƒ': 'æ··åˆå…¨éƒ¨æ•ˆæœ - æœ€å¤§ç¨‹åº¦çš„æŸå'
            };
            
            const description = typeDescriptions[app.glitchType] || '';
            displayMessage('âœ… å·²é€‰æ‹©æŸåç±»å‹: ' + app.glitchType + '\n\n' + description);
        }

        function selectIntensity(intensity) {
            // æ›´æ–°å•é€‰æŒ‰é’®çŠ¶æ€
            const items = document.querySelectorAll('#intensitySelection .checkbox-item');
            items.forEach(item => {
                const input = item.querySelector('input');
                if (input.value === intensity) {
                    item.classList.add('selected');
                    input.checked = true;
                } else {
                    item.classList.remove('selected');
                    input.checked = false;
                }
            });
            
            // æ›´æ–°åº”ç”¨ç¨‹åºçŠ¶æ€
            const intensities = {
                '1': '0.00001 - æè½»å¾® (0.0001%)',
                '2': '0.0001 - è½»å¾® (0.001%)', 
                '3': '0.001 - ä¸­ç­‰ (0.01%)',
                '4': '0.01 - å¼ºçƒˆ (0.1%)',
                '5': '0.08 - æ¯ç­çº§ (0.8%)'
            };
            app.intensity = intensities[intensity] || 'æœªé€‰æ‹©';
            updateCurrentSettingsDisplay();
            
            const intensityValue = app.intensity.split(' - ')[0];
            updateStatus('âœ… å¼ºåº¦: ' + intensityValue);
            
            const intensityDescriptions = {
                '1': 'æè½»å¾® - å‡ ä¹ä¸å¯è§çš„å¾®å°å˜åŒ–',
                '2': 'è½»å¾® - ç»†å¾®çš„è‰ºæœ¯æ•ˆæœ',
                '3': 'ä¸­ç­‰ - æ˜æ˜¾çš„æŸåæ•ˆæœ', 
                '4': 'å¼ºçƒˆ - æ˜¾è‘—çš„è§†è§‰å†²å‡»',
                '5': 'æ¯ç­çº§ - æœ€å¤§ç¨‹åº¦çš„æŸå'
            };
            
            const description = intensityDescriptions[intensity] || '';
            displayMessage('âœ… å·²é€‰æ‹©æŸåå¼ºåº¦: ' + app.intensity + '\n\n' + description);
        }

        // è‡ªå®šä¹‰å¼ºåº¦å¯¹è¯æ¡†å‡½æ•°
        function showCustomIntensityDialog() {
            const dialog = document.getElementById('customIntensityDialog');
            const overlay = document.getElementById('customIntensityOverlay');
            if (dialog && overlay) {
                dialog.style.display = 'block';
                overlay.style.display = 'block';
                
                const input = document.getElementById('customIntensityInput');
                if (input) {
                    input.focus();
                    input.select();
                }
            }
        }

        function confirmCustomIntensity() {
            const input = document.getElementById('customIntensityInput');
            if (input && input.value) {
                const value = input.value;
                try {
                    const floatValue = parseFloat(value);
                    if (floatValue >= 0.00001 && floatValue <= 100) {
                        // æ›´æ–°å•é€‰æŒ‰é’®çŠ¶æ€
                        const customItem = document.querySelector('#intensitySelection .checkbox-item:nth-child(6)');
                        if (customItem) {
                            customItem.classList.add('selected');
                            customItem.querySelector('input').checked = true;
                        }
                        
                        // æ›´æ–°åº”ç”¨ç¨‹åºçŠ¶æ€
                        app.intensity = `custom (${value})`;
                        updateCurrentSettingsDisplay();
                        updateStatus('âœ… è‡ªå®šä¹‰å¼ºåº¦: ' + value);
                        
                        displayMessage(`âœ… å·²è®¾ç½®è‡ªå®šä¹‰å¼ºåº¦: ${value}\n\nè¿™å°†æŸåçº¦ ${(floatValue*1000).toFixed(3)}% çš„å®‰å…¨åŒºåŸŸå­—èŠ‚`);
                        hideCustomIntensityDialog();
                    } else {
                        alert('å¼ºåº¦å€¼å¿…é¡»åœ¨ 0.00001 åˆ° 100 ä¹‹é—´');
                    }
                } catch (e) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—');
                }
            } else {
                alert('è¯·è¾“å…¥å¼ºåº¦å€¼');
            }
        }

        function cancelCustomIntensity() {
            hideCustomIntensityDialog();
            displayMessage('âŒ å·²å–æ¶ˆè‡ªå®šä¹‰å¼ºåº¦è®¾ç½®');
        }

        function hideCustomIntensityDialog() {
            const dialog = document.getElementById('customIntensityDialog');
            const overlay = document.getElementById('customIntensityOverlay');
            if (dialog && overlay) {
                dialog.style.display = 'none';
                overlay.style.display = 'none';
            }
        }

        // è¾“å‡ºæ–‡ä»¶åè®¾ç½®å¯¹è¯æ¡†å‡½æ•°
        function showOutputFileDialog() {
            const dialog = document.getElementById('outputFileDialog');
            const overlay = document.getElementById('outputFileOverlay');
            if (dialog && overlay) {
                const input = document.getElementById('outputFileInput');
                if (input) {
                    input.value = app.outputFile;
                }
                
                dialog.style.display = 'block';
                overlay.style.display = 'block';
                
                if (input) {
                    input.focus();
                    input.select();
                }
            }
        }

        function confirmOutputFile() {
            const input = document.getElementById('outputFileInput');
            if (input) {
                let value = input.value.trim();
                if (value) {
                    // ç¡®ä¿æœ‰æ­£ç¡®çš„æ–‡ä»¶æ‰©å±•å
                    if (!value.toLowerCase().endsWith('.mp4')) {
                        value += '.mp4';
                    }
                    
                    // æ›´æ–°åº”ç”¨ç¨‹åºçŠ¶æ€
                    app.outputFile = value;
                    updateCurrentSettingsDisplay();
                    
                    hideOutputFileDialog();
                    showSuccess(`è¾“å‡ºæ–‡ä»¶åå·²è®¾ç½®ä¸º: ${value}`);
                    updateStatus('âœ… è¾“å‡ºæ–‡ä»¶åå·²è®¾ç½®');
                } else {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ–‡ä»¶å');
                }
            }
        }

        function cancelOutputFile() {
            hideOutputFileDialog();
        }

        function hideOutputFileDialog() {
            const dialog = document.getElementById('outputFileDialog');
            const overlay = document.getElementById('outputFileOverlay');
            if (dialog && overlay) {
                dialog.style.display = 'none';
                overlay.style.display = 'none';
            }
        }

        // é‡ç½®è®¾ç½®
        function resetSettings() {
            app.inputFile = null;
            app.fileContent = null;
            app.mode = 'mp4';
            app.glitchType = 'æœªé€‰æ‹©';
            app.intensity = 'æœªé€‰æ‹©';
            app.outputFile = 'glitched_video.mp4';
            app.disclaimerAccepted = false; // é‡ç½®å…è´£å£°æ˜çŠ¶æ€
            
            // é‡ç½®UI
            selectMode('mp4');
            updateCurrentSettingsDisplay();
            hideProgress();
            
            // é‡ç½®æ–‡ä»¶ä¿¡æ¯
            const fileInfo = document.getElementById('fileInfo');
            if (fileInfo) {
                fileInfo.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
                fileInfo.style.background = '#fff3cd';
                fileInfo.style.borderLeftColor = '#ffc107';
            }
            
            displayMessage('âœ… è®¾ç½®å·²é‡ç½®');
            updateStatus('å·¥å…·å·²å°±ç»ªï¼Œè¯·é€‰æ‹©æ–‡ä»¶å¼€å§‹...');
        }

        // æ˜¾ç¤ºæ•™ç¨‹
        function showTutorial() {
            const tutorialText = `ğŸ“š è§†é¢‘è‰ºæœ¯æŸåå·¥å…· - ä½¿ç”¨æ•™ç¨‹

ğŸ¯ åŸºæœ¬ç”¨æ³•:
1. ç‚¹å‡»"é€‰æ‹©è§†é¢‘æ–‡ä»¶"é€‰æ‹©æ–‡ä»¶
2. åœ¨å·¥ä½œæ¨¡å¼ä¸­é€‰æ‹© MP4æ¨¡å¼ æˆ– æ–‡ä»¶æ¨¡å¼
3. åœ¨æŸåç±»å‹ä¸­é€‰æ‹©æƒ³è¦çš„æ•ˆæœ
4. åœ¨æŸåå¼ºåº¦ä¸­é€‰æ‹©æŸåç¨‹åº¦
5. ç‚¹å‡»"å¼€å§‹æŸåå¤„ç†"

ğŸ”§ å·¥ä½œæ¨¡å¼è¯´æ˜:
â€¢ MP4æ¨¡å¼ - ä¿æŠ¤å…³é”®æ•°æ®ï¼Œç¡®ä¿æ–‡ä»¶å¯æ’­æ”¾
â€¢ æ–‡ä»¶æ¨¡å¼ - æ— ä¿æŠ¤ï¼Œå…¨æ–‡ä»¶æŸå

ğŸ¨ æŸåç±»å‹è¯´æ˜:
â€¢ mode1-mode7 - ä¸åŒçš„è‰ºæœ¯æŸåæ•ˆæœ
â€¢ å®Œå…¨å´©æºƒ - æ··åˆå…¨éƒ¨æ•ˆæœ

âš¡ å¼ºåº¦çº§åˆ«è¯´æ˜:
â€¢ 0.00001 - æŸå 0.0001% å­—èŠ‚ (æè½»å¾®)
â€¢ 0.0001  - æŸå 0.001%  å­—èŠ‚ (è½»å¾®)
â€¢ 0.001   - æŸå 0.01%    å­—èŠ‚ (ä¸­ç­‰)
â€¢ 0.01    - æŸå 0.1%     å­—èŠ‚ (å¼ºçƒˆ)
â€¢ 0.08    - æŸå 0.8%     å­—èŠ‚ (æ¯ç­çº§)

âš ï¸ é‡è¦æé†’:
â€¢ è¯·ä½¿ç”¨æ²¡æœ‰éŸ³é¢‘çš„è§†é¢‘æ–‡ä»¶
â€¢ å¤„ç†å‰è¯·å¤‡ä»½é‡è¦æ–‡ä»¶
â€¢ æ–‡ä»¶æ¨¡å¼å¯èƒ½åˆ›å»ºæ— æ³•æ’­æ”¾çš„æ–‡ä»¶
â€¢ ä½¿ç”¨åˆé€‚çš„å¼ºåº¦ä»¥è·å¾—æœ€ä½³æ•ˆæœ
â€¢ å¤„ç†å®Œæˆåæ–‡ä»¶å°†è‡ªåŠ¨ä¸‹è½½`;
            
            displayMessage(tutorialText);
            updateStatus('ğŸ“š æŸ¥çœ‹æ•™ç¨‹');
        }

        // éªŒè¯å‚æ•°
        function validateParameters() {
            if (!app.inputFile) {
                return 'è¯·å…ˆé€‰æ‹©è¦å¤„ç†çš„è§†é¢‘æ–‡ä»¶';
            }
            if (app.glitchType === 'æœªé€‰æ‹©') {
                return 'è¯·é€‰æ‹©æŸåç±»å‹';
            }
            if (app.intensity === 'æœªé€‰æ‹©') {
                return 'è¯·é€‰æ‹©æŸåå¼ºåº¦';
            }
            return null;
        }

        // è·å–å¼ºåº¦æ•°å€¼
        function getIntensityValue() {
            if (app.intensity.startsWith('custom')) {
                const match = app.intensity.match(/custom\s*\(([^)]+)\)/);
                return match ? parseFloat(match[1]) : 0.0005;
            }
            
            const intensityMap = {
                '0.00001 - æè½»å¾® (0.0001%)': 0.00001,
                '0.0001 - è½»å¾® (0.001%)': 0.0001,
                '0.001 - ä¸­ç­‰ (0.01%)': 0.001,
                '0.01 - å¼ºçƒˆ (0.1%)': 0.01,
                '0.08 - æ¯ç­çº§ (0.8%)': 0.08
            };
            
            return intensityMap[app.intensity] || 0.0001;
        }

        // æŸ¥æ‰¾ä¿æŠ¤åŒº
        function findProtectedRegions(arrayBuffer) {
            const dataView = new DataView(arrayBuffer);
            const protectedRegions = [];
            
            // æŸ¥æ‰¾ "mdat" å­—ç¬¦ä¸² (0x6D 0x64 0x61 0x74)
            for (let i = 0; i < arrayBuffer.byteLength - 4; i++) {
                if (dataView.getUint8(i) === 0x6D && 
                    dataView.getUint8(i+1) === 0x64 && 
                    dataView.getUint8(i+2) === 0x61 && 
                    dataView.getUint8(i+3) === 0x74) {
                    // ä¿æŠ¤ä»å¼€å§‹åˆ° mdat+128 çš„ä½ç½®
                    protectedRegions.push({ start: 0, end: i + 128 });
                }
            }
            
            // æŸ¥æ‰¾ "mp4" å­—ç¬¦ä¸² (0x6D 0x70 0x34)
            for (let i = 0; i < arrayBuffer.byteLength - 3; i++) {
                if (dataView.getUint8(i) === 0x6D && 
                    dataView.getUint8(i+1) === 0x70 && 
                    dataView.getUint8(i+2) === 0x34) {
                    // ä¿æŠ¤ä»å¼€å§‹åˆ° mp4+128 çš„ä½ç½®
                    protectedRegions.push({ start: 0, end: i + 128 });
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°å…³é”®å­—ç¬¦ä¸²ï¼Œä¿æŠ¤å‰1024ä¸ªå­—èŠ‚
            if (protectedRegions.length === 0) {
                protectedRegions.push({ start: 0, end: 1024 });
            }
            
            // åˆå¹¶é‡å çš„ä¿æŠ¤åŒº
            protectedRegions.sort((a, b) => a.start - b.start);
            const mergedRegions = [];
            let currentRegion = protectedRegions[0];
            
            for (let i = 1; i < protectedRegions.length; i++) {
                const region = protectedRegions[i];
                if (region.start <= currentRegion.end) {
                    currentRegion.end = Math.max(currentRegion.end, region.end);
                } else {
                    mergedRegions.push(currentRegion);
                    currentRegion = region;
                }
            }
            mergedRegions.push(currentRegion);
            
            return mergedRegions;
        }

        // æ£€æŸ¥ä½ç½®æ˜¯å¦åœ¨ä¿æŠ¤åŒºå†…
        function isProtected(position, protectedRegions) {
            for (const region of protectedRegions) {
                if (position >= region.start && position < region.end) {
                    return true;
                }
            }
            return false;
        }

        // çœŸæ­£çš„è§†é¢‘æŸåå¤„ç†å‡½æ•° - æ•ˆæœå‡å°‘100å€
        function glitchVideo(arrayBuffer, type, intensity) {
            const data = new Uint8Array(arrayBuffer);
            const totalBytes = data.length;
            
            // å¦‚æœæ˜¯MP4æ¨¡å¼ï¼Œè®¡ç®—ä¿æŠ¤åŒº
            let protectedRegions = [];
            let protectionInfo = "";
            if (app.mode === 'mp4') {
                protectedRegions = findProtectedRegions(arrayBuffer);
                protectionInfo = `ğŸ›¡ï¸ MP4æ¨¡å¼ä¿æŠ¤æ¿€æ´»\næ‰¾åˆ° ${protectedRegions.length} ä¸ªä¿æŠ¤åŒº\n`;
            }
            
            // æ ¹æ®å¼ºåº¦è®¡ç®—è¦æŸåçš„å­—èŠ‚æ•° - å‡å°‘100å€
            let bytesToCorrupt;
            if (intensity === 0.08) { // æ¯ç­çº§
                bytesToCorrupt = Math.floor(totalBytes * 0.008); // 0.8% è€Œä¸æ˜¯ 80%
            } else {
                bytesToCorrupt = Math.floor(totalBytes * intensity * 0.001); // å‡å°‘100å€
            }
            
            // ç¡®ä¿è‡³å°‘æŸå1ä¸ªå­—èŠ‚
            bytesToCorrupt = Math.max(1, bytesToCorrupt);
            
            let corruptedCount = 0;
            let protectedCount = 0;
            
            // æ ¹æ®æŸåç±»å‹åº”ç”¨ä¸åŒçš„æŸåæ¨¡å¼
            switch(type) {
                case 'mode1': // çº¿æ¡æŸå - å‡å°‘æŸåèŒƒå›´
                    for (let i = 0; i < bytesToCorrupt; i++) {
                        const pos = Math.floor(Math.random() * (totalBytes - 10)) + 5;
                        if (!isProtected(pos, protectedRegions)) {
                            // åªæŸå2-3ä¸ªå­—èŠ‚è€Œä¸æ˜¯10ä¸ª
                            const damageLength = 2 + Math.floor(Math.random() * 2);
                            for (let j = 0; j < damageLength; j++) {
                                if (pos + j < totalBytes && !isProtected(pos + j, protectedRegions)) {
                                    // è½»å¾®å˜åŒ–è€Œä¸æ˜¯å®Œå…¨éšæœº
                                    data[pos + j] = (data[pos + j] + Math.floor(Math.random() * 16)) % 256;
                                    corruptedCount++;
                                }
                            }
                        } else {
                            protectedCount++;
                        }
                    }
                    break;
                    
                case 'mode2': // æ—¶é—´å€’æµ - å‡å°‘äº¤æ¢é¢‘ç‡
                    for (let i = 0; i < bytesToCorrupt / 2; i++) {
                        const pos = Math.floor(Math.random() * totalBytes);
                        if (!isProtected(pos, protectedRegions) && pos < totalBytes - 4) {
                            const temp = data[pos];
                            data[pos] = data[pos + 4];
                            data[pos + 4] = temp;
                            corruptedCount += 2;
                        } else {
                            protectedCount++;
                        }
                    }
                    break;
                    
                case 'mode3': // è‰²å—å¼‚å¸¸ - å‡å°‘å—å¤§å°
                    for (let i = 0; i < bytesToCorrupt; i++) {
                        const pos = Math.floor(Math.random() * totalBytes);
                        if (!isProtected(pos, protectedRegions) && pos < totalBytes - 5) {
                            const blockSize = 2 + Math.floor(Math.random() * 3); // 2-4ä¸ªå­—èŠ‚
                            for (let j = 0; j < blockSize; j++) {
                                if (pos + j < totalBytes && !isProtected(pos + j, protectedRegions)) {
                                    // è½»å¾®çš„é¢œè‰²åç§»
                                    data[pos + j] = (data[pos + j] + 32) % 256;
                                    corruptedCount++;
                                }
                            }
                        } else {
                            protectedCount++;
                        }
                    }
                    break;
                    
                case 'mode4': // æ•°æ®æ··åˆ - å‡å°‘äº¤æ¢æ¬¡æ•°
                    for (let i = 0; i < bytesToCorrupt / 3; i++) {
                        const pos1 = Math.floor(Math.random() * totalBytes);
                        const pos2 = Math.floor(Math.random() * totalBytes);
                        if (!isProtected(pos1, protectedRegions) && !isProtected(pos2, protectedRegions)) {
                            const temp = data[pos1];
                            data[pos1] = data[pos2];
                            data[pos2] = temp;
                            corruptedCount += 2;
                        } else {
                            protectedCount++;
                        }
                    }
                    break;
                    
                case 'mode5': // ç”»é¢å†»ç»“ - å‡å°‘å†»ç»“åŒºåŸŸ
                    for (let i = 0; i < bytesToCorrupt / 20; i++) {
                        const pos = Math.floor(Math.random() * (totalBytes - 100));
                        if (!isProtected(pos, protectedRegions)) {
                            const freezeSize = 10 + Math.floor(Math.random() * 40); // 10-50ä¸ªå­—èŠ‚
                            const freezeValue = Math.floor(Math.random() * 256);
                            for (let j = 0; j < freezeSize; j++) {
                                if (pos + j < totalBytes && !isProtected(pos + j, protectedRegions)) {
                                    data[pos + j] = freezeValue;
                                    corruptedCount++;
                                }
                            }
                        } else {
                            protectedCount++;
                        }
                    }
                    break;
                    
                case 'mode6': // ç”»é¢æŠ–åŠ¨ - å‡å°‘æŠ–åŠ¨å¼ºåº¦
                    for (let i = 0; i < bytesToCorrupt; i++) {
                        const pos = Math.floor(Math.random() * totalBytes);
                        if (!isProtected(pos, protectedRegions) && pos < totalBytes - 2) {
                            // è½»å¾®æŠ–åŠ¨
                            data[pos] = (data[pos] + data[pos + 1] * 0.1) % 256;
                            corruptedCount++;
                        } else {
                            protectedCount++;
                        }
                    }
                    break;
                    
                case 'mode7': // é€šé“åç§» - å‡å°‘åç§»é‡
                    for (let i = 0; i < bytesToCorrupt; i++) {
                        const pos = Math.floor(Math.random() * totalBytes);
                        if (!isProtected(pos, protectedRegions) && pos < totalBytes - 1) {
                            data[pos] = data[pos + 1];
                            corruptedCount++;
                        } else {
                            protectedCount++;
                        }
                    }
                    break;
                    
                case 'å®Œå…¨å´©æºƒ': // æ··åˆå…¨éƒ¨æ•ˆæœ - å¤§å¹…å‡å°‘å¼ºåº¦
                    const methods = ['mode1', 'mode2', 'mode3', 'mode4', 'mode5', 'mode6', 'mode7'];
                    const tempData = new Uint8Array(data);
                    
                    for (const method of methods) {
                        const methodBytes = Math.floor(bytesToCorrupt / methods.length / 3); // è¿›ä¸€æ­¥å‡å°‘
                        for (let i = 0; i < methodBytes; i++) {
                            const pos = Math.floor(Math.random() * totalBytes);
                            if (!isProtected(pos, protectedRegions)) {
                                if (method === 'mode1' && pos < totalBytes - 3) {
                                    for (let j = 0; j < 2; j++) {
                                        if (pos + j < totalBytes && !isProtected(pos + j, protectedRegions)) {
                                            tempData[pos + j] = (tempData[pos + j] + 8) % 256;
                                        }
                                    }
                                } else if (method === 'mode2' && pos < totalBytes - 4 && Math.random() < 0.3) {
                                    [tempData[pos], tempData[pos + 4]] = [tempData[pos + 4], tempData[pos]];
                                } else if (method === 'mode3' && pos < totalBytes - 2) {
                                    for (let j = 0; j < 2; j++) {
                                        if (pos + j < totalBytes && !isProtected(pos + j, protectedRegions)) {
                                            tempData[pos + j] = (tempData[pos + j] + 16) % 256;
                                        }
                                    }
                                } else if (method === 'mode4' && Math.random() < 0.2) {
                                    const pos2 = Math.floor(Math.random() * totalBytes);
                                    if (!isProtected(pos2, protectedRegions)) {
                                        [tempData[pos], tempData[pos2]] = [tempData[pos2], tempData[pos]];
                                    }
                                } else if (method === 'mode5' && pos < totalBytes - 10 && Math.random() < 0.1) {
                                    const freezeValue = tempData[pos];
                                    for (let j = 0; j < 5; j++) {
                                        if (pos + j < totalBytes && !isProtected(pos + j, protectedRegions)) {
                                            tempData[pos + j] = freezeValue;
                                        }
                                    }
                                } else if (method === 'mode6' && pos < totalBytes - 2) {
                                    tempData[pos] = (tempData[pos] + tempData[pos + 1] * 0.05) % 256;
                                } else if (method === 'mode7' && pos < totalBytes - 1) {
                                    tempData[pos] = tempData[pos + 1];
                                }
                                corruptedCount++;
                            } else {
                                protectedCount++;
                            }
                        }
                    }
                    
                    // å°†ä¸´æ—¶æ•°æ®å¤åˆ¶å›åŸæ•°ç»„
                    for (let i = 0; i < totalBytes; i++) {
                        data[i] = tempData[i];
                    }
                    break;
                    
                default: // é»˜è®¤æŸåæ¨¡å¼ - è½»å¾®éšæœºå˜åŒ–
                    for (let i = 0; i < bytesToCorrupt; i++) {
                        const pos = Math.floor(Math.random() * totalBytes);
                        if (!isProtected(pos, protectedRegions)) {
                            // è½»å¾®å˜åŒ–è€Œä¸æ˜¯å®Œå…¨éšæœº
                            data[pos] = (data[pos] + Math.floor(Math.random() * 8)) % 256;
                            corruptedCount++;
                        } else {
                            protectedCount++;
                        }
                    }
            }
            
            return {
                buffer: data.buffer,
                protectionInfo: protectionInfo + `ä¿æŠ¤äº† ${protectedCount} ä¸ªå­—èŠ‚ï¼ŒæŸåäº† ${corruptedCount} ä¸ªå­—èŠ‚`
            };
        }

        // å¼€å§‹å¤„ç†
        async function startProcessing() {
            const error = validateParameters();
            if (error) {
                showError(error);
                updateStatus('âŒ å‚æ•°ä¸å®Œæ•´');
                return;
            }

            if (!app.fileContent) {
                showError('æ–‡ä»¶å†…å®¹æœªåŠ è½½ï¼Œè¯·é‡æ–°é€‰æ‹©æ–‡ä»¶');
                return;
            }

            // æ˜¾ç¤ºç¡®è®¤ä¿¡æ¯
            const confirmText = `ğŸ” å¤„ç†ç¡®è®¤

ğŸ“ è¾“å…¥æ–‡ä»¶: ${app.inputFile}
ğŸ¯ æŸåç±»å‹: ${app.glitchType}
âš™ï¸ å·¥ä½œæ¨¡å¼: ${app.mode === 'mp4' ? 'MP4æ¨¡å¼' : 'æ–‡ä»¶æ¨¡å¼'}
âš¡ æŸåå¼ºåº¦: ${app.intensity}
ğŸ’¾ è¾“å‡ºæ–‡ä»¶: ${app.outputFile}

ğŸ”„ å¼€å§‹å¤„ç†ä¸­...`;
            
            displayMessage(confirmText);
            updateStatus('ğŸ”„ å¤„ç†ä¸­...');
            updateProgress(0);

            try {
                // è·å–å¼ºåº¦æ•°å€¼
                const intensityValue = getIntensityValue();
                
                // æ¨¡æ‹Ÿå¤„ç†è¿›åº¦
                for (let i = 0; i <= 5; i++) {
                    await new Promise(resolve => setTimeout(resolve, 300));
                    const percent = i * 20;
                    updateProgress(percent);
                    
                    let progressText = 'æ­£åœ¨å¤„ç†æ–‡ä»¶...\n';
                    for (let j = 0; j <= i; j++) {
                        progressText += `ğŸ“Š å¤„ç†è¿›åº¦: ${j * 20}%\n`;
                    }
                    displayMessage(confirmText + '\n' + progressText);
                }

                // çœŸæ­£çš„è§†é¢‘æŸåå¤„ç†
                updateProgress(60);
                displayMessage(confirmText + '\nğŸ“Š å¤„ç†è¿›åº¦: 60%\nğŸ”§ æ­£åœ¨åº”ç”¨æŸåæ•ˆæœ...');
                
                const result = glitchVideo(app.fileContent, app.glitchType, intensityValue);
                const glitchedBuffer = result.buffer;
                const protectionInfo = result.protectionInfo;
                
                updateProgress(80);
                displayMessage(confirmText + '\nğŸ“Š å¤„ç†è¿›åº¦: 80%\nğŸ’¾ æ­£åœ¨ç”Ÿæˆè¾“å‡ºæ–‡ä»¶...');
                
                // è®¡ç®—æŸåç»Ÿè®¡
                const originalSize = app.fileContent.byteLength;
                const glitchedSize = glitchedBuffer.byteLength;
                const corruptedBytes = Math.abs(glitchedSize - originalSize);
                const corruptionRate = ((corruptedBytes / originalSize) * 100).toFixed(4);
                
                updateProgress(100);
                
                // æ˜¾ç¤ºç»“æœ
                const resultText = `âœ… å¤„ç†å®Œæˆ!

ğŸ“Š å¤„ç†ç»Ÿè®¡:
â€¢ åŸå§‹æ–‡ä»¶å¤§å°: ${(originalSize / 1024 / 1024).toFixed(2)} MB
â€¢ æŸååå¤§å°: ${(glitchedSize / 1024 / 1024).toFixed(2)} MB  
â€¢ æŸåå­—èŠ‚æ•°: ${corruptedBytes.toLocaleString()} å­—èŠ‚
â€¢ æŸåç‡: ${corruptionRate}%

ğŸ“ æ–‡ä»¶ä¿¡æ¯:
â€¢ è¾“å…¥æ–‡ä»¶: ${app.inputFile}
â€¢ å·¥ä½œæ¨¡å¼: ${app.mode}
â€¢ æŸåç±»å‹: ${app.glitchType}
â€¢ æŸåå¼ºåº¦: ${app.intensity}
â€¢ è¾“å‡ºæ–‡ä»¶: ${app.outputFile}

${protectionInfo}

ğŸ’¾ æ–‡ä»¶å·²å‡†å¤‡ä¸‹è½½`;
                
                displayMessage(resultText);
                updateStatus('âœ… å¤„ç†å®Œæˆ');

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([glitchedBuffer], { type: 'video/mp4' });
                const url = URL.createObjectURL(blob);
                const downloadLink = document.getElementById('downloadLink');
                
                if (downloadLink) {
                    downloadLink.href = url;
                    downloadLink.download = app.outputFile;
                    downloadLink.click();
                    
                    // æ¸…ç†URLå¯¹è±¡
                    setTimeout(() => {
                        URL.revokeObjectURL(url);
                    }, 1000);
                }

            } catch (error) {
                showError('å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error.message);
                updateStatus('âŒ å¤„ç†å¤±è´¥');
                hideProgress();
            }
        }

        // æ–‡ä»¶è¾“å…¥å¤„ç†
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    app.inputFile = file.name;
                    app.fileContent = e.target.result;
                    app.fileType = file.type;
                    
                    // æ›´æ–°æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
                    const fileInfo = document.getElementById('fileInfo');
                    if (fileInfo) {
                        const fileSize = (file.size / 1024 / 1024).toFixed(2);
                        fileInfo.innerHTML = `<strong>âœ… å·²é€‰æ‹©æ–‡ä»¶:</strong> ${file.name}<br>
                                            <strong>ğŸ“Š æ–‡ä»¶å¤§å°:</strong> ${fileSize} MB<br>
                                            <strong>ğŸ“ æ–‡ä»¶ç±»å‹:</strong> ${file.type || 'æœªçŸ¥'}`;
                        fileInfo.style.background = '#d4edda';
                        fileInfo.style.borderLeftColor = '#27ae60';
                    }
                    
                    // è‡ªåŠ¨è®¾ç½®è¾“å‡ºæ–‡ä»¶å
                    const baseName = file.name.replace(/\.[^/.]+$/, "");
                    app.outputFile = `${baseName}_glitched.mp4`;
                    updateCurrentSettingsDisplay();
                    
                    updateStatus('âœ… æ–‡ä»¶å·²åŠ è½½');
                    showSuccess(`æ–‡ä»¶ "${file.name}" å·²æˆåŠŸåŠ è½½ï¼Œå‡†å¤‡å¤„ç†`);
                };
                
                reader.onerror = function() {
                    showError('æ–‡ä»¶è¯»å–å¤±è´¥');
                    updateStatus('âŒ æ–‡ä»¶è¯»å–å¤±è´¥');
                };
                
                reader.readAsArrayBuffer(file);
            }
        });

        // åˆå§‹åŒ–è®¾ç½®æ˜¾ç¤º
        updateCurrentSettingsDisplay();
        updateStatus('å·¥å…·å·²å°±ç»ªï¼Œè¯·é€‰æ‹©æ–‡ä»¶å¼€å§‹...');
        displayMessage('ğŸ¬ è§†é¢‘è‰ºæœ¯æŸåå·¥å…·\n\næ¬¢è¿ä½¿ç”¨ï¼è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\n1. é€‰æ‹©è¦å¤„ç†çš„è§†é¢‘æ–‡ä»¶\n2. è®¾ç½®æŸåå‚æ•°\n3. å¼€å§‹å¤„ç†\n\nä½¿ç”¨"ä½¿ç”¨æ•™ç¨‹"æŒ‰é’®æŸ¥çœ‹è¯¦ç»†è¯´æ˜ã€‚');
    </script>
<svg style="z-index:9997;position:fixed;bottom:0;right:0" viewBox="0 0 315 27" width="315" height="27">
  <path d="M143.905 0.043004L85.585 0.105C75.385 0.0870005 66.415 1.866 58.655 5.535C50.765 9.265 42.855 12.989 34.975 16.73C27.165 20.443 26.057 22.638 15.778 22.501C5.775 22.368 2.44 26.781 0 26.781L0.545006 26.693C22.005 26.672 43.455 26.676 64.915 26.676C90.655 26.676 116.395 26.665 142.135 26.699C143.115 26.699 143.915 26.259 143.915 25.707C143.855 11.729 143.855 14.026 143.915 0.0490007L143.905 0.043004Z" fill="#292929"></path>
  <path d="M140.258 0L315 0.340524L314.966 27L140 26.9616L140.258 0Z" fill="#292929"></path>
</svg>
<div style="z-index:9998;font-family:sans-serif;background-color:#292929;padding:2px 8px;position:fixed;bottom:0;right:0;left:0"></div>
<div style="z-index:9999;color:white;font-size: 0.7rem;font-family:sans-serif;padding: 5px;position:fixed;bottom:0;right:0">
  <a href="https://pyscript.com/@mp4_damage" id="made-on" target="_blank" style="color:#FFF;text-decoration:none;">Made on pyscript.com</a>&nbsp;â”‚&nbsp;<a href="https://pyscript.com/@mp4_damage/index/latest" id="view-code" target="_blank" style="color:#FFF;text-decoration:none;">View Code</a><span id="install-pwa-section">&nbsp;â”‚&nbsp; <a id="install-pwa" style="cursor:pointer; color:#FFF;">Install</a></span>&nbsp;&nbsp;
</div>

<script>
let installPrompt = null;
const installSection = document.querySelector("#install-pwa-section")
const installButton = document.querySelector("#install-pwa");

window.addEventListener("beforeinstallprompt", (event) => {
  if ("onappinstalled" in window) {
    installSection.removeAttribute("hidden")
  }
  event.preventDefault();
  installPrompt = event;
});

installButton.addEventListener("click", async () => {
  if (!installPrompt) {
    return;
  }
  const result = await installPrompt.prompt();
  disableInAppInstallPrompt();
});

function disableInAppInstallPrompt() {
  installPrompt = null;
  installButton.setAttribute("hidden", "");
};
</script>

<script>
  const heap_app_id = "758475466";
  // Only add analytics if we got an id
  if (heap_app_id) {
    // Analytics code
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src="https://cdn.heapanalytics.com/js/heap-"+e+".js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(r,a);for(var n=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","resetIdentity","removeEventProperty","setEventProperties","track","unsetEventProperty"],o=0;o<p.length;o++)heap[p[o]]=n(p[o])};
    heap.load(heap_app_id);

    // Add event listener to the made-on link
    document.querySelector("#made-on").addEventListener("click", () => {
      heap.track("PSADC - Make on Pyscript");
    });
    // Add event listener to the view-code link
    document.querySelector("#view-code").addEventListener("click", () => {
      heap.track("PSADC - View Code");
    });
    // Add event listener to the install-pwa link
    document.querySelector("#install-pwa").addEventListener("click", () => {
      heap.track("PSADC - Install PWA");
    });
  }
</script>
<cs-native-frame-holder hidden=""><template shadowrootmode="closed"><iframe id="cs-native-frame" hidden="" title="Intentionally blank" sandbox="allow-same-origin"></iframe></template></cs-native-frame-holder></body></html>